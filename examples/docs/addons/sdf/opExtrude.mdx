---
title: 'opExtrude'
description: '2D to 3D extrusion operation for signed distance fields'
keywords: [SDF, extrude, 2D, 3D, operation, transform]
date: 2025-08-06
---

import { FragmentEditor } from '@site/src/theme/FragmentEditor'

# opExtrude: Two-Dimensional to Three-Dimensional SDF Extrusion

### Geometric Dimensional Extension Operation

The `opExtrude` function transforms a 2D signed distance field into a 3D volume by extruding along the Z-axis. This operation creates cylindrical or prismatic shapes from planar geometry by combining the 2D distance with Z-axis boundary constraints.

## Mathematical Foundation

The extrusion operation combines 2D distance with axial bounds:

$$
d_{\text{extrude}} = \min(\max(d_{2D}, |p_z| - h), 0) + |\max(\vec{w}, 0)|
$$

where $\vec{w} = (d_{2D}, |p_z| - h)$ represents the combined distance vector and $h$ defines the extrusion height.

This formulation creates smooth transitions at edges while maintaining correct interior and exterior classifications.

## Function Signature

| Parameter | Type    | Description                       |
| --------- | ------- | --------------------------------- |
| `p`       | `vec3`  | 3D sample point position          |
| `sdf`     | `float` | 2D SDF result at point (p.x, p.y) |
| `h`       | `float` | Half-height of extrusion          |

## Implementation Demonstration

<FragmentEditor
        code={`
const fragment = () => {
        const up = vec3(0, 1, 0)
        const eye = vec3(5)
        const eps = vec3(0.01, 0, 0)
        const args = [1.2]
        const march = Fn(([eye, dir]: [Vec3, Vec3]) => {
                const p = eye.toVar()
                const d2d = circleSDF(vec2(p.x, p.y), 0.8).min(
                        rectSDF(vec2(p.x.add(0.3), p.y), vec2(0.3, 0.6))
                ).max(circleSDF(vec2(p.x.sub(0.2), p.y.add(0.1)), 0.25).negate())
                const d = opExtrude(p, d2d, ...args).toVar()
                Loop(16, ({ i }) => {
                        If(d.lessThanEqual(eps.x), () => {
                                const dx2d = circleSDF(vec2(p.add(eps.xyy).x, p.add(eps.xyy).y), 0.8).min(
                                        rectSDF(vec2(p.add(eps.xyy).x.add(0.3), p.add(eps.xyy).y), vec2(0.3, 0.6))
                                ).max(circleSDF(vec2(p.add(eps.xyy).x.sub(0.2), p.add(eps.xyy).y.add(0.1)), 0.25).negate())
                                const dy2d = circleSDF(vec2(p.add(eps.yxy).x, p.add(eps.yxy).y), 0.8).min(
                                        rectSDF(vec2(p.add(eps.yxy).x.add(0.3), p.add(eps.yxy).y), vec2(0.3, 0.6))
                                ).max(circleSDF(vec2(p.add(eps.yxy).x.sub(0.2), p.add(eps.yxy).y.add(0.1)), 0.25).negate())
                                const dz2d = circleSDF(vec2(p.add(eps.yyx).x, p.add(eps.yyx).y), 0.8).min(
                                        rectSDF(vec2(p.add(eps.yyx).x.add(0.3), p.add(eps.yyx).y), vec2(0.3, 0.6))
                                ).max(circleSDF(vec2(p.add(eps.yyx).x.sub(0.2), p.add(eps.yyx).y.add(0.1)), 0.25).negate())
                                const dx = opExtrude(p.add(eps.xyy), dx2d, ...args).sub(d)
                                const dy = opExtrude(p.add(eps.yxy), dy2d, ...args).sub(d)
                                const dz = opExtrude(p.add(eps.yyx), dz2d, ...args).sub(d)
                                return vec4(vec3(dx, dy, dz).normalize().mul(0.5).add(0.5), 1)
                        })
                        p.assign(p.add(d.mul(dir)))
                        const d2dNew = circleSDF(vec2(p.x, p.y), 0.8).min(
                                rectSDF(vec2(p.x.add(0.3), p.y), vec2(0.3, 0.6))
                        ).max(circleSDF(vec2(p.x.sub(0.2), p.y.add(0.1)), 0.25).negate())
                        d.assign(opExtrude(p, d2dNew, ...args))
                })
                return vec4(0)
        })
        const z = eye.negate().normalize()
        const x = z.cross(up)
        const y = x.cross(z)
        const scr = vec3(uv.sub(0.5), 2)
        const dir = mat3(x, y, z).mul(scr).normalize()
        return march(eye, dir)
}`}
/>
